<mat-dialog-content>
    <mat-tab-group>
        <mat-tab label="Utilisateur">

            <div fxLayout="column" fxLayoutGap="10px" class="padding-v">

                <mat-form-field class="width-auto" >
                    <input matInput [disabled]="!!data.item.id" name="login" placeholder="Login" [(ngModel)]="data.item.login" >
                </mat-form-field>

                <mat-form-field *ngIf="!isShibbolethUser()">
                    <input matInput type="email" name="email" placeholder="Email" [(ngModel)]="data.item.email" >
                </mat-form-field>

                <div *ngIf="(user?.globalPermissions?.user?.create || data.item?.permissions?.update) && !isShibbolethUser()" [formGroup]="passwordGroupCtrl" fxLayout="column" fxLayoutGap="10px" >
                    <mat-form-field>
                        <input matInput type="password" name="password" placeholder="Mot de passe" [(ngModel)]="data.item.password" [formControl]="passwordCtrl" >
                    </mat-form-field>

                    <mat-form-field>
                        <input matInput type="password" name="password_confirmation" placeholder="Confirmation du mot passe" [formControl]="passwordConfirmationCtrl">

                        <mat-error  *ngIf="passwordConfirmationCtrl.hasError('password')">Le mot de passe n'est pas identique</mat-error>
                    </mat-form-field>
                </div>

                <app-thesaurus [service]="institutionService"
                               placeholder="Institution"
                               [model]="institution"
                               (modelChange)="data.item.institution = $event"
                               [multiple]="false"
                ></app-thesaurus>

                <mat-form-field>
                    <input matInput
                           name="activeUntil"
                           placeholder="Active jusqu'au"
                           [(ngModel)]="data.item.activeUntil"
                           [matDatepicker]="picker"
                    >
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                </mat-form-field>

                <mat-form-field *ngIf="data.item.id">
                    <input matInput
                           disabled
                           name="termsAgreement"
                           placeholder="Licence"
                           [(ngModel)]="data.item.termsAgreement"
                           [matDatepicker]="picker2"
                    >
                    <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                    <mat-datepicker #picker2></mat-datepicker>
                </mat-form-field>

                <mat-form-field>
                    <mat-select placeholder="RÃ´le" [(value)]="data.item.role" [disabled]="user?.id === data?.item?.id">
                        <mat-option *ngFor="let role of roles" [value]="role.name"> {{ role.text }}</mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field *ngIf="data.item.id">
                    <input matInput disabled name="type" placeholder="Type d'utilisateur" [(ngModel)]="data.item.type" >
                </mat-form-field>
            </div>
        </mat-tab>

    </mat-tab-group>
</mat-dialog-content>

<mat-dialog-actions>
    <app-dialog-footer fxFlex
                       [canCreate]="user?.globalPermissions?.user?.create"
                       [item]="data.item"
                       [formCtrl]="passwordConfirmationCtrl"
                       (create)="create()"
                       (update)="update()"
                       (delete)="delete()"
    ></app-dialog-footer>
</mat-dialog-actions>
